<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document CafÃ©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            background: #f5f2ed;
            background-image: 
                linear-gradient(135deg, rgba(245, 242, 237, 0.9) 0%, rgba(232, 223, 213, 0.9) 100%),
                repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(139, 102, 53, 0.02) 35px, rgba(139, 102, 53, 0.02) 70px);
            color: #3d2817;
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 20px;
            box-shadow: 0 4px 12px rgba(139, 102, 53, 0.1);
        }

        h1 {
            font-size: 2.5rem;
            color: #4a7c59;
            margin-bottom: 0.5rem;
            font-weight: 400;
        }

        .coffee-icon {
            display: inline-block;
            animation: steam 3s ease-in-out infinite;
        }

        @keyframes steam {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        .subtitle {
            color: #6b5d54;
            font-size: 1.1rem;
            font-style: italic;
        }

        .loading {
            text-align: center;
            padding: 4rem 2rem;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(139, 102, 53, 0.1);
        }

        .spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            margin-bottom: 1rem;
        }

        .spinner::after {
            content: 'â˜•';
            font-size: 40px;
            display: block;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        .error {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #d4a574;
            color: #8b6635;
            padding: 2rem;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(139, 102, 53, 0.1);
        }

        .error h2 {
            color: #8b6635;
            margin-bottom: 1rem;
        }

        .documents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        .document-card {
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid rgba(74, 124, 89, 0.2);
            border-radius: 16px;
            padding: 1.5rem;
            text-decoration: none;
            display: block;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(139, 102, 53, 0.1);
            position: relative;
            overflow: hidden;
        }

        .document-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #5b8a9d, #4a7c59, #8b6635);
            transition: left 0.5s ease;
        }

        .document-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(139, 102, 53, 0.15);
            border-color: #4a7c59;
        }

        .document-card:hover::before {
            left: 0;
        }

        .document-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #5b8a9d, #4a7c59);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            font-size: 24px;
            color: white;
            box-shadow: 0 2px 6px rgba(74, 124, 89, 0.3);
        }

        .document-title {
            color: #3d2817;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .document-description {
            color: #6b5d54;
            font-size: 0.95rem;
            margin-bottom: 0.8rem;
            line-height: 1.4;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .document-meta {
            color: #6b5d54;
            font-size: 0.9rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(139, 102, 53, 0.1);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        footer {
            margin-top: 4rem;
            text-align: center;
            color: #6b5d54;
            font-size: 0.9rem;
            padding: 2rem;
        }

        footer a {
            color: #4a7c59;
            text-decoration: none;
            transition: color 0.2s;
        }

        footer a:hover {
            color: #5a9970;
            text-decoration: underline;
        }

        /* ãƒ‡ãƒãƒƒã‚°æƒ…å ±è¡¨ç¤ºç”¨ */
        .debug-info {
            margin-top: 2rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.85rem;
            color: #6b5d54;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .documents-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><span class="coffee-icon">â˜•</span> Document CafÃ©</h1>
            <p class="subtitle">~ Ryo Tamura's personal document sharing space ~</p>
        </header>

        <main id="content">
            <div class="loading">
                <div class="spinner"></div>
                <p>Brewing your documents...</p>
            </div>
        </main>
    </div>

    <footer>
        <p>Served fresh from <a href="https://github.com/ryotamuraite/PrivateSaronn" target="_blank">GitHub Pages</a> â˜•</p>
    </footer>

    <script>
        // è¨­å®š
        const CONFIG = {
            owner: 'ryotamuraite',
            repo: 'PrivateSaronn',
            folder: 'documents',
            branch: 'main'
        };

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ã‚’å–å¾—ï¼ˆãƒ©ãƒ³ãƒ€ãƒ å‹•ç‰©ã‚¢ã‚¤ã‚³ãƒ³ç‰ˆï¼‰
        function getFileIcon(filename) {
            // ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰ä¸€æ„ã®ãƒãƒƒã‚·ãƒ¥å€¤ã‚’ç”Ÿæˆï¼ˆåŒã˜ãƒ•ã‚¡ã‚¤ãƒ«ã¯å¸¸ã«åŒã˜ã‚¢ã‚¤ã‚³ãƒ³ï¼‰
            let hash = 0;
            for (let i = 0; i < filename.length; i++) {
                const char = filename.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            
            // å¯æ„›ã„å‹•ç‰©ã‚¢ã‚¤ã‚³ãƒ³ã®é…åˆ—
            const animals = [
                'ğŸ•', 'ğŸˆ', 'ğŸ‡', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 'ğŸ¨', 'ğŸ¯', 'ğŸ¦', 'ğŸ®',
                'ğŸ·', 'ğŸ¸', 'ğŸµ', 'ğŸ”', 'ğŸ§', 'ğŸ¦', 'ğŸ¦†', 'ğŸ¦…', 'ğŸ¦‰', 'ğŸ¦‡',
                'ğŸº', 'ğŸ—', 'ğŸ´', 'ğŸ¦„', 'ğŸ', 'ğŸª²', 'ğŸ›', 'ğŸ¦‹', 'ğŸŒ', 'ğŸ',
                'ğŸœ', 'ğŸ¦Ÿ', 'ğŸ¦—', 'ğŸ•·ï¸', 'ğŸ¦‚', 'ğŸ¢', 'ğŸ', 'ğŸ¦', 'ğŸ¦–', 'ğŸ¦•',
                'ğŸ™', 'ğŸ¦‘', 'ğŸ¦', 'ğŸ¦', 'ğŸ¦€', 'ğŸ¡', 'ğŸ ', 'ğŸŸ', 'ğŸ¬', 'ğŸ³',
                'ğŸ‹', 'ğŸ¦ˆ', 'ğŸŠ', 'ğŸ…', 'ğŸ†', 'ğŸ¦“', 'ğŸ¦', 'ğŸ¦§', 'ğŸ¦£', 'ğŸ˜',
                'ğŸ¦›', 'ğŸ¦', 'ğŸ¦’', 'ğŸ¦˜', 'ğŸ¦¬', 'ğŸƒ', 'ğŸ‚', 'ğŸ„', 'ğŸ¦Œ', 'ğŸ•â€ğŸ¦º',
                'ğŸ¦®', 'ğŸ©', 'ğŸ•', 'ğŸ¦¤', 'ğŸ¦š', 'ğŸ¦œ', 'ğŸ¦¢', 'ğŸ¦©', 'ğŸ¦«', 'ğŸ¦¦',
                'ğŸ¦¥', 'ğŸ', 'ğŸ€', 'ğŸ¦”', 'ğŸ¿ï¸', 'ğŸ¦¨'
            ];
            
            // ãƒãƒƒã‚·ãƒ¥å€¤ã‚’ä½¿ã£ã¦å‹•ç‰©ã‚’é¸æŠï¼ˆçµ¶å¯¾å€¤ã«ã—ã¦æ­£ã®æ•°ã«ã™ã‚‹ï¼‰
            const index = Math.abs(hash) % animals.length;
            return animals[index];
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatFileSize(bytes) {
            if (!bytes) return 'N/A';
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(1024));
            return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
        }

        // æ—¥ä»˜ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('ja-JP', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æ•´å½¢ï¼ˆæ—¥æœ¬èªå¯¾å¿œï¼‰
        function formatTitle(filename) {
            // ã¾ãšã¯æ‹¡å¼µå­ã‚’é™¤å»
            let title = filename.replace(/\.[^/.]+$/, '');
            
            // ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã‚„ãƒã‚¤ãƒ•ãƒ³ã‚’å‡¦ç†
            title = title.replace(/[-_]/g, ' ');
            
            // æ—¥æœ¬èªãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã¯ãã®ã¾ã¾ã€è‹±èªã®ã¿ãªã‚‰å„å˜èªã‚’å¤§æ–‡å­—ã«
            if (/[^\x00-\x7F]/.test(title)) {
                return title;
            } else {
                return title.replace(/\b\w/g, l => l.toUpperCase());
            }
        }

        // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸€è¦§ã‚’å–å¾—ã—ã¦è¡¨ç¤º
        async function loadDocuments() {
            const contentDiv = document.getElementById('content');
            
            try {
                const apiUrl = `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.folder}?ref=${CONFIG.branch}`;
                
                console.log('Fetching from:', apiUrl);
                
                const response = await fetch(apiUrl, {
                    headers: {
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                console.log('Response status:', response.status);

                if (response.status === 404) {
                    contentDiv.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">ğŸ“</div>
                            <h2>æº–å‚™ä¸­...</h2>
                            <p style="margin-top: 1rem;">
                                ã¾ãš "documents" ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚<br>
                                GitHubã§ã€ŒAdd fileã€â†’ã€ŒCreate new fileã€â†’<br>
                                ãƒ•ã‚¡ã‚¤ãƒ«åã« <code>documents/README.md</code> ã¨å…¥åŠ›ã—ã¦ã‚³ãƒŸãƒƒãƒˆ
                            </p>
                        </div>
                    `;
                    return;
                }

                if (!response.ok) {
                    throw new Error(`GitHub API Error: ${response.status}`);
                }

                const files = await response.json();
                
                console.log('Files data:', files);
                
                // HTMLãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ãƒ•ã‚£ãƒ«ã‚¿
                const htmlFiles = files.filter(file => 
                    file.type === 'file' && 
                    (file.name.endsWith('.html') || file.name.endsWith('.htm'))
                );

                if (htmlFiles.length === 0) {
                    contentDiv.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">â˜•</div>
                            <h2>ã¾ã ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒã‚ã‚Šã¾ã›ã‚“</h2>
                            <p style="margin-top: 1rem;">
                                documentsãƒ•ã‚©ãƒ«ãƒ€ã«HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã™ã‚‹ã¨<br>
                                ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™
                            </p>
                        </div>
                    `;
                    return;
                }

                // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                let metadata = {};
                try {
                    const metadataUrl = `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.folder}/metadata.json?ref=${CONFIG.branch}`;
                    const metadataResponse = await fetch(metadataUrl, {
                        headers: {
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (metadataResponse.ok) {
                        const metadataFile = await metadataResponse.json();
                        // Base64ãƒ‡ã‚³ãƒ¼ãƒ‰
                        const metadataContent = atob(metadataFile.content);
                        metadata = JSON.parse(metadataContent);
                        console.log('Metadata loaded:', metadata);
                    }
                } catch (e) {
                    console.log('Could not load metadata.json:', e);
                }

                // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
                const cardsHTML = htmlFiles.map(file => {
                    const fileUrl = `https://${CONFIG.owner}.github.io/${CONFIG.repo}/${CONFIG.folder}/${file.name}`;
                    
                    // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æƒ…å ±ã‚’å–å¾—ï¼ˆãªã‘ã‚Œã°ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ï¼‰
                    const fileMetadata = metadata[file.name] || {};
                    const title = fileMetadata.title || formatTitle(file.name);
                    const description = fileMetadata.description || '';
                    const lastModified = fileMetadata.lastModified || null;
                    const author = fileMetadata.author || '';
                    
                    return `
                        <a href="${fileUrl}" class="document-card" target="_blank">
                            <div class="document-icon">${getFileIcon(file.name)}</div>
                            <div class="document-title">${title}</div>
                            ${description ? `<div class="document-description">${description}</div>` : ''}
                            <div class="document-meta">
                                <span>ğŸ“… ${formatDate(lastModified)}</span>
                                <span>ğŸ’¾ ${formatFileSize(file.size)}</span>
                                ${author ? `<span>âœï¸ ${author}</span>` : ''}
                            </div>
                        </a>
                    `;
                }).join('');

                contentDiv.innerHTML = `<div class="documents-grid">${cardsHTML}</div>`;

            } catch (error) {
                console.error('Error:', error);
                
                // ã‚¨ãƒ©ãƒ¼å†…å®¹ã‚’è©³ç´°ã«è¡¨ç¤º
                contentDiv.innerHTML = `
                    <div class="error">
                        <h2>âš ï¸ èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼</h2>
                        <p>${error.message}</p>
                        <p style="margin-top: 1rem; font-size: 0.9rem;">
                            ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç’°å¢ƒã§ã¯å‹•ä½œã—ãªã„å ´åˆãŒã‚ã‚Šã¾ã™ã€‚<br>
                            GitHubã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾Œã«ç¢ºèªã—ã¦ãã ã•ã„ã€‚
                        </p>
                        <div class="debug-info">
                            <strong>Debug Info:</strong><br>
                            Owner: ${CONFIG.owner}<br>
                            Repo: ${CONFIG.repo}<br>
                            Folder: ${CONFIG.folder}<br>
                            Branch: ${CONFIG.branch}
                        </div>
                    </div>
                `;
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
        document.addEventListener('DOMContentLoaded', loadDocuments);
    </script>
</body>
</html>
